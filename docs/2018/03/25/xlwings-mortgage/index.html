<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Enable bigfoot footnotes -->
    <!-- <link rel="stylesheet" href="/docs/theme/css/bigfoot-default.css" /> -->
    <link rel="stylesheet" href="../../../../theme/css/bigfoot-default.css" />

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Matthew Kudija">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <title>xlwings: Use Python and Excel to Calculate Your Mortgage | Matthew Kudija</title>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" title="Matthew Kudija blog atom feed" href="/feeds/all.atom.xml" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/theme/css/icons.css"/>
    <style>.highlight .hll { background-color: #49483e }
.highlight  { background: #272822; color: #f8f8f2 }
.highlight .c { color: #75715e } /* Comment */
.highlight .err { color: #960050; background-color: #1e0010 } /* Error */
.highlight .k { color: #66d9ef } /* Keyword */
.highlight .l { color: #ae81ff } /* Literal */
.highlight .n { color: #f8f8f2 } /* Name */
.highlight .o { color: #f92672 } /* Operator */
.highlight .p { color: #f8f8f2 } /* Punctuation */
.highlight .ch { color: #75715e } /* Comment.Hashbang */
.highlight .cm { color: #75715e } /* Comment.Multiline */
.highlight .cp { color: #75715e } /* Comment.Preproc */
.highlight .cpf { color: #75715e } /* Comment.PreprocFile */
.highlight .c1 { color: #75715e } /* Comment.Single */
.highlight .cs { color: #75715e } /* Comment.Special */
.highlight .gd { color: #f92672 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gi { color: #a6e22e } /* Generic.Inserted */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #75715e } /* Generic.Subheading */
.highlight .kc { color: #66d9ef } /* Keyword.Constant */
.highlight .kd { color: #66d9ef } /* Keyword.Declaration */
.highlight .kn { color: #f92672 } /* Keyword.Namespace */
.highlight .kp { color: #66d9ef } /* Keyword.Pseudo */
.highlight .kr { color: #66d9ef } /* Keyword.Reserved */
.highlight .kt { color: #66d9ef } /* Keyword.Type */
.highlight .ld { color: #e6db74 } /* Literal.Date */
.highlight .m { color: #ae81ff } /* Literal.Number */
.highlight .s { color: #e6db74 } /* Literal.String */
.highlight .na { color: #a6e22e } /* Name.Attribute */
.highlight .nb { color: #f8f8f2 } /* Name.Builtin */
.highlight .nc { color: #a6e22e } /* Name.Class */
.highlight .no { color: #66d9ef } /* Name.Constant */
.highlight .nd { color: #a6e22e } /* Name.Decorator */
.highlight .ni { color: #f8f8f2 } /* Name.Entity */
.highlight .ne { color: #a6e22e } /* Name.Exception */
.highlight .nf { color: #a6e22e } /* Name.Function */
.highlight .nl { color: #f8f8f2 } /* Name.Label */
.highlight .nn { color: #f8f8f2 } /* Name.Namespace */
.highlight .nx { color: #a6e22e } /* Name.Other */
.highlight .py { color: #f8f8f2 } /* Name.Property */
.highlight .nt { color: #f92672 } /* Name.Tag */
.highlight .nv { color: #f8f8f2 } /* Name.Variable */
.highlight .ow { color: #f92672 } /* Operator.Word */
.highlight .w { color: #f8f8f2 } /* Text.Whitespace */
.highlight .mb { color: #ae81ff } /* Literal.Number.Bin */
.highlight .mf { color: #ae81ff } /* Literal.Number.Float */
.highlight .mh { color: #ae81ff } /* Literal.Number.Hex */
.highlight .mi { color: #ae81ff } /* Literal.Number.Integer */
.highlight .mo { color: #ae81ff } /* Literal.Number.Oct */
.highlight .sa { color: #e6db74 } /* Literal.String.Affix */
.highlight .sb { color: #e6db74 } /* Literal.String.Backtick */
.highlight .sc { color: #e6db74 } /* Literal.String.Char */
.highlight .dl { color: #e6db74 } /* Literal.String.Delimiter */
.highlight .sd { color: #e6db74 } /* Literal.String.Doc */
.highlight .s2 { color: #e6db74 } /* Literal.String.Double */
.highlight .se { color: #ae81ff } /* Literal.String.Escape */
.highlight .sh { color: #e6db74 } /* Literal.String.Heredoc */
.highlight .si { color: #e6db74 } /* Literal.String.Interpol */
.highlight .sx { color: #e6db74 } /* Literal.String.Other */
.highlight .sr { color: #e6db74 } /* Literal.String.Regex */
.highlight .s1 { color: #e6db74 } /* Literal.String.Single */
.highlight .ss { color: #e6db74 } /* Literal.String.Symbol */
.highlight .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #a6e22e } /* Name.Function.Magic */
.highlight .vc { color: #f8f8f2 } /* Name.Variable.Class */
.highlight .vg { color: #f8f8f2 } /* Name.Variable.Global */
.highlight .vi { color: #f8f8f2 } /* Name.Variable.Instance */
.highlight .vm { color: #f8f8f2 } /* Name.Variable.Magic */
.highlight .il { color: #ae81ff } /* Literal.Number.Integer.Long */</style>
    <style>.highlight pre, .highlighttable pre {
  /*note: this is for code block background-color;*/
    background: #272822;
    color: #f8f8f2;
}

body {
  margin: 0;
  padding: 0;
  font: 15px 'Source Sans Pro', sans-serif;
  line-height: 1.6em;
  color: #222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
a {
  color: #007EE5;
  text-decoration: none;
}
a:hover {
  color: #007EE5;
  text-decoration: none;
}
header.main-header {
  /*background: none repeat scroll 0% 0% #205F29;*/
  background: none repeat scroll 0% 0% #3377B3;
  margin-bottom: 0px;
}
header.main-header a {
  color: #fff;
}
header.main-header .container {
  max-width: 1000px;
}
header.main-header .container nav a:hover {
  background-color: #3377B3;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  margin-bottom: 20px;
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  font-size: 0.85em;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  font-size: 0.85em;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p {
  font-size: 18px;
  margin-bottom: 20px;
  line-height: 1.6em;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article ul,
article ol {
  margin-top: 0px;
  margin-bottom: 25px;
}
article li {
  font-size: 16px;
  line-height: 1.6em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article img {
  max-width: 100%;
}
article code {
  color: #333;
  background-color: #EEE;
  border-radius: 0;
  font-size: 13px;
}
article .meta {
  font-size: 11px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta div {
  margin-bottom: 20px;
  display: block;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 14px;
  font-weight: 800;
  padding: 10px 20px;
  /*color: #205F29;*/
  color: #3377B3;
  background: #FFF;
  /*border: 1px solid #205F29;*/
  border: 1px solid #3377B3;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  /*background: #3377B3;*/
  background: #3377B3;
}
.index {
  max-width: 700px;
}
.index article header h2 {
  font-size: 36px;
  margin-bottom: 2px;
  font-weight: 700;
}
.index article header h2 a {
  color: #000;
}
.index article header h2 a:hover {
  color: #007EE5;
  text-decoration: none;
}
.index .separator {
  padding: 40px 0 0 0;
  margin: 0 0 40px 0;
  height: 10px;
  border-bottom: solid 1px #CCC;
}
.index .pagination {
  display: block;
  margin-bottom: 100px;
}
.index .pagination .left {
  text-align: right;
}
.index .pagination .right {
  text-align: left;
}
.index .pagination a {
  display: inline-block;
  border: 2px solid #3377B3;
  margin: 0 5px;
  padding: 8px 20px;
  font-weight: bold;
  color: #3377B3;
}
.index .pagination a:hover {
  color: #FFF;
  background: #3377B3;
}
.post {
  max-width: 700px;
}
.post h2:before {
  content: "# ";
  font-weight: bold;
  color: #DDD;
}
.post h3:before {
  content: "## ";
  font-weight: bold;
  color: #DDD;
}
.post h4:before {
  content: "### ";
  font-weight: bold;
  color: #DDD;
}
.post article .meta {
  margin: 50px 0 100px;
}
.list {
  max-width: 700px;
}
.list ul.double-list {
  margin: 0 auto 60px;
  padding: 0;
  list-style-type: none;
}
.list ul.double-list li {
  padding: 5px 0;
}
.list ul.double-list li h2 {
  font-size: 1em;
  display: inline;
  font-weight: normal;
}
.list ul.double-list li span {
  font-family: sans-serif;
  text-transform: uppercase;
  text-align: right;
  float: right;
  padding-top: 3px;
  font-size: 12px;
  color: #999;
}
.full-width-content {
  padding-top: 10px;
  padding-left: 0px;
  padding-right: 0px;
  margin-left: -20px;
  margin-right: -20px;
}
.col-xs-1,
.col-sm-1,
.col-md-1,
.col-lg-1,
.col-xs-2,
.col-sm-2,
.col-md-2,
.col-lg-2,
.col-xs-3,
.col-sm-3,
.col-md-3,
.col-lg-3,
.col-xs-4,
.col-sm-4,
.col-md-4,
.col-lg-4,
.col-xs-5,
.col-sm-5,
.col-md-5,
.col-lg-5,
.col-xs-6,
.col-sm-6,
.col-md-6,
.col-lg-6,
.col-xs-7,
.col-sm-7,
.col-md-7,
.col-lg-7,
.col-xs-8,
.col-sm-8,
.col-md-8,
.col-lg-8,
.col-xs-9,
.col-sm-9,
.col-md-9,
.col-lg-9,
.col-xs-10,
.col-sm-10,
.col-md-10,
.col-lg-10,
.col-xs-11,
.col-sm-11,
.col-md-11,
.col-lg-11,
.col-xs-12,
.col-sm-12,
.col-md-12,
.col-lg-12 {
  padding-right: 0px;
  padding-left: 0px;
}
.video-container {
    position:relative;
    padding-bottom:56.25%;
    padding-top:30px;
    height:0;
    overflow:hidden;
}

.video-container iframe, .video-container object, .video-container embed {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}</style>

    <!-- Begin Mailchimp Style -->
    <link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
    <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px 'Source Sans Pro',Helvetica,Arial,sans-serif; }

    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
    We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- End Mailchimp Style -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
                // MathJax loaded
                MathJax.Hub.Config({
                    tex2jax: {
                        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                    },
                    displayAlign: 'left', // Change this to 'center' to center equations.
                    "HTML-CSS": {
                        styles: {'.MathJax_Display': {"margin": 0}}
                    }
                });
                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            }
        }
        init_mathjax();
    </script>

</head>

<body>
    <header class="navbar navbar-inverse bs-docs-nav">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span> 
              </button>
              <a class="navbar-brand" href="/" title="Home" class="title">Matthew Kudija</a>
          </div>
          <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="https://matthewkudija.com/blog" title="Blog">Notes</a></li>
                <li><a href="https://matthewkudija.com/about.html" title="About">About</a></li>
                <!--                 <li><a href="https://matthewkudija.com/photos" target="_blank" title="Photos">Photos</a></li>
 -->
                <!--                 <li><a href="http://github.com/mkudija" target="_blank" title="mkudija's Github" rel="me">Github</a></li>
 -->
                <!--                 <li><a href="http://twitter.com/mkudija" target="_blank" title="mkudija Twitter" rel="me">Twitter</a></li>
 -->
                <li><a href="mailto:m.kudija@gmail.com?Subject=Blog%3A%20&Body=Hi%20Matthew%2C%0A%0A" title="mailto:m.kudija@gmail.com?Subject=Blog%3A%20&Body=Hi%20Matthew%2C%0A%0A" rel="me">Email</a></li>
                <li><a href="https://matthewkudija.com/blog/archives.html" title="Archive">Archive</a></li>
            </ul>
        </nav>
    </div>
</header>

<div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>xlwings: Use Python and Excel to Calculate Your Mortgage</h1>
            <time datetime="article.date.isoformat()" pubdate>Sun 25 March 2018</time>
        </header>

        <div class="article_content">
            <!-- status: draft -->



<p><img alt src="../../../../images/xlwings-mortgage-1.gif"></p>
<p>The Python <a href="https://www.xlwings.org/">xlwings</a> library provides easy interaction between Python and a Microsoft Excel workbook. In this example, I'll demonstrate using Excel as a wrapper around a Python function, with xlwings providing the link between the two.</p>


<h1 id="when-to-use-xlwings">When to use xlwings</h1>
<p>Python and Excel have complementary strengths and it can be useful to use them together. Excel is great for lightweight data exploration where you need some interactivity. Since Excel is the default tool for data analysis in the corporate world an average user is probably much less intimidated by an Excel spreadsheet than a <code>.py</code> or <code>.ipynb</code> file. Python provides heavy-duty analytics, has thousands of libraries freely available to add functionality, and allows you to make your analysis more reproducable since it can be version-controlled and quickly re-run with new data. </p>
<p>Great reasons to use xlwings include:</p>
<ul>
<li><strong>Extending Excel:</strong> Let's face it—Excel has limits. When you want to run a loop or add some additional analytics power to Excel without writing VBA, Python is a great option.</li>
<li><strong>Python Front End:</strong> For all of Python's power there are situations where it can be tedious to continually interact with a function. While there are much more elegant (and Python-native) solutions available, Excel can be a low-overhead front end for interacting with Python in certain situations.</li>
<li><strong>Sharing:</strong> We already acknowledged that most people are more comfortable with Excel than Python. But in my experience, average Excel users are perfectly alright to use a tool in Excel that uses some Python behind the scenes (and even intrigued by the experience), as long as the proper support is provided to get them up and running.</li>
</ul>
<p>Using xlwings to link Excel and Python can bring the best of both worlds. Let's get started.</p>
<h1 id="wrapping-a-python-function">Wrapping a Python Function</h1>
<p>The easiest way to get started with xlwings is to download and modify a working example. There are great examples on the <a href="https://www.xlwings.org/examples">xlwings page</a>, or you can download all the files used to create this example <a href="https://github.com/mkudija/blog/tree/master/content/downloads/code/xlwings-mortgage">here</a>. </p>
<h2 id="basic-structure">Basic Structure</h2>
<p>When all set up, our project directory will have two files:</p>
<div class="highlight"><pre><span></span><code><span class="go">├── Mortgage.xlsm</span>
<span class="go">└── mortgage.py</span>
</code></pre></div>

<p>Notice that <strong><code>Mortgage.xlsm</code></strong> is a macro-enabled Excel workbook. A macro—assigned to a button—will be used to initiate the the Python script. Our Python file <strong><code>mortgage.py</code></strong> contains our function, as well as the xlwings code to read from and write to the Excel workbook.</p>
<p><img alt src="../../../../images/xlwings-mortgage-1.png"></p>
<h2 id="python-function">Python Function</h2>
<p>The Python function we will use as an example is a financial model in pandas written by <a href="https://twitter.com/chris1610">Chris Moffitt</a>. We will take this function as an input, but please see Chris' <a href="http://pbpython.com/amortization-model-revised.html">original post</a> for the details. This model builds a loan amortization table, such as you would need to evaluate a mortgage. Given the required inputs of loan principal, interest rate, term, etc. this Python function returns a pandas DataFrame giving the amortization table. </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">amortize</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">addl_principal</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">annual_payments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The below code, which may have been edited, was originally written by </span>
<span class="sd">    Chris Moffitt of pbpython.com (used with permission):</span>
<span class="sd">    - Blog Post: http://pbpython.com/amortization-model-revised.html</span>
<span class="sd">    - Code: https://github.com/chris1610/pbpython/blob/63e810a42d30c8297b82f6da43e5e962b8a6f15a/notebooks/Amortization-Corrected-Final.ipynb</span>
<span class="sd">    - License: https://github.com/chris1610/pbpython/blob/63e810a42d30c8297b82f6da43e5e962b8a6f15a/LICENSE</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pmt</span> <span class="o">=</span> <span class="o">-</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pmt</span><span class="p">(</span><span class="n">interest_rate</span><span class="o">/</span><span class="n">annual_payments</span><span class="p">,</span> <span class="n">years</span><span class="o">*</span><span class="n">annual_payments</span><span class="p">,</span> <span class="n">principal</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># initialize the variables to keep track of the periods and running balances</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">beg_balance</span> <span class="o">=</span> <span class="n">principal</span>
    <span class="n">end_balance</span> <span class="o">=</span> <span class="n">principal</span>

    <span class="k">while</span> <span class="n">end_balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

        <span class="c1"># Recalculate the interest based on the current balance</span>
        <span class="n">interest</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(((</span><span class="n">interest_rate</span><span class="o">/</span><span class="n">annual_payments</span><span class="p">)</span> <span class="o">*</span> <span class="n">beg_balance</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Determine payment based on whether or not this period will pay off the loan</span>
        <span class="n">pmt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pmt</span><span class="p">,</span> <span class="n">beg_balance</span> <span class="o">+</span> <span class="n">interest</span><span class="p">)</span>
        <span class="n">principal</span> <span class="o">=</span> <span class="n">pmt</span> <span class="o">-</span> <span class="n">interest</span>

        <span class="c1"># Ensure additional payment gets adjusted if the loan is being paid off</span>
        <span class="n">addl_principal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">addl_principal</span><span class="p">,</span> <span class="n">beg_balance</span> <span class="o">-</span> <span class="n">principal</span><span class="p">)</span>
        <span class="n">end_balance</span> <span class="o">=</span> <span class="n">beg_balance</span> <span class="o">-</span> <span class="p">(</span><span class="n">principal</span> <span class="o">+</span> <span class="n">addl_principal</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span><span class="n">start_date</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;Period&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;BeginBalance&#39;</span><span class="p">,</span> <span class="n">beg_balance</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;Payment&#39;</span><span class="p">,</span> <span class="n">pmt</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;Principal&#39;</span><span class="p">,</span> <span class="n">principal</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;Interest&#39;</span><span class="p">,</span> <span class="n">interest</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;AddPayment&#39;</span><span class="p">,</span> <span class="n">addl_principal</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;EndBalance&#39;</span><span class="p">,</span> <span class="n">end_balance</span><span class="p">)])</span>

        <span class="c1"># Increment the counter, balance and date</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">start_date</span> <span class="o">+=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">beg_balance</span> <span class="o">=</span> <span class="n">end_balance</span>
</code></pre></div>

<p>Remember that while we are using a financial model as an example, just about anything you can do in Python is fair game for extending the capabilities of Excel.</p>
<h2 id="set-up-the-workbook">Set up the workbook</h2>
<p>First, let's set up the Excel workbook. Our user will set values for the required inputs, press the "Calculate" button, and see outputs written by xlwings. The chart is a native Excel chart constructed off the table in the outputs, but xlwings <a href="http://docs.xlwings.org/en/stable/matplotlib.html">can write image files</a> to Excel so you could generate charts in matplotlib or another Python plotting library as well. This is a standard <code>.xlsm</code> macro-enabled Excel workbook, so you can apply formatting and add charts as you like.</p>
<p><img alt src="../../../../images/xlwings-mortgage-2.png"></p>
<h2 id="set-up-python-with-xlwings">Set up Python with xlwings</h2>
<p>Our Python script <strong><code>mortgage.py</code></strong> uses xlwings to interface with Excel. First we include the <code>amortize()</code> function discussed previously. All the xlwings for interacting with the workbook is in the <code>main()</code> function. Here we define the sheet(s) to pull from, clear previous values as necessary, perform calculations, and write calculated values to Excel.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">amortize</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">addl_principal</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">annual_payments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function shown above</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="c1"># --------------------------------------------------------------------------------------------------------    </span>
<span class="kn">import</span> <span class="nn">xlwings</span> <span class="k">as</span> <span class="nn">xw</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="c1"># --------------------------------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># define sheet(s)</span>
    <span class="n">sht</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="o">.</span><span class="n">caller</span><span class="p">()</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="s1">&#39;Inputs&#39;</span><span class="p">]</span>

    <span class="c1"># clear sheet(s)</span>
    <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;A17&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">clear_contents</span><span class="p">()</span>

    <span class="c1"># read inputs</span>
    <span class="n">principal</span>       <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C5&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">interest_rate</span>   <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C6&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">years</span>           <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C7&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">addl_principal</span>  <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">annual_payments</span> <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">start_date</span>      <span class="o">=</span> <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">dates</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># perform calcs</span>
    <span class="n">schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">amortize</span><span class="p">(</span><span class="n">principal</span><span class="p">,</span> <span class="n">interest_rate</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">addl_principal</span><span class="p">,</span> <span class="n">annual_payments</span><span class="p">,</span> <span class="n">start_date</span><span class="p">))</span>
    <span class="n">payoff_date</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># write values to Excel</span>
    <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;C15&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">payoff_date</span>
    <span class="n">sht</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;A17&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">schedule</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Expects the Excel file next to this source file, adjust accordingly.</span>
    <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="p">(</span><span class="s1">&#39;Mortgage.xlsm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_mock_caller</span><span class="p">()</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<h2 id="set-up-the-macro">Set up the macro</h2>
<p>Finally, map the the <strong>Calculate</strong> button to the <code>Button_click()</code> macro to call <code>mortgage.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">Sub</span> <span class="n">Button_click</span><span class="p">()</span>
    <span class="n">RunPython</span> <span class="p">(</span><span class="s2">&quot;import mortgage; mortgage.main()&quot;</span><span class="p">)</span>
<span class="n">End</span> <span class="n">Sub</span>
</code></pre></div>

<p>Note that in this macro <code>mortgage</code> is the name of our script, and <code>main</code> is the function to call from within our script. You can easily have different buttons call different functions from the same script. This can be helpful for more complicated workbooks. For example, with multiple buttons you could load data with one, enter values or modify the data, and then use another button to load the modified data and perform final calculations.</p>
<h2 id="run-it">Run it</h2>
<p>Running the workbook is as simple as updating your inputs and clicking <strong>Calculate</strong>. </p>
<p><img alt src="../../../../images/xlwings-mortgage-1.gif"></p>
<p>You will notice the <code>if __name__ == '__main__':</code> statement at the end of <strong><code>mortgage.py</code></strong>. This allows us to run the script by calling <code>python mortgage.py</code> from the command line instead of pressing the <strong>Calculate</strong> button in the workbook. This can be especially helpful for debugging when you want to print values or read error messages. </p>
<p><img alt src="../../../../images/xlwings-mortgage-3.gif"></p>
<h1 id="closing-thoughts">Closing Thoughts</h1>
<p>I hope this illustrates the ability to connect Excel to Pyton and prompts you to think about useful applications for this. All that is needed is a bit of glue to hold the two together, for which xlwings is a great tool. To learn more about xlwings and other options for interacting with worksheets using Python, have a look at the links below: </p>
<ul>
<li><a href="https://www.pyxll.com/blog/tools-for-working-with-excel-and-python/">Tools for Working with Excel and Python</a>: written by the developers of pyxll (a subscription based package), this also gives a nice overview of multiple options for working with Excel.</li>
<li><a href="https://automatetheboringstuff.com/chapter12/">Automate the Boring Stuff</a>: Al Sweigart's great overview of using openpyxl, which was my first introduction to the topic.</li>
<li><a href="https://www.datacamp.com/community/tutorials/python-excel-tutorial">DataCamp</a> also has a good Excel tutorial.</li>
</ul>
<!-- NOTES:
- used LICEcap for GIF screen animations: https://www.cockos.com/licecap/
 -->
        </div>

        <div class="meta">
            <div>
                <a href="../../../../tag/python.html" class="tag">python</a>
                <a href="../../../../tag/pandas.html" class="tag">pandas</a>
                <a href="../../../../tag/xlwings.html" class="tag">xlwings</a>
                <a href="../../../../tag/excel.html" class="tag">excel</a>
            </div>
        </div>
    </article>

    <div class="container">
        <!-- Begin MailChimp Signup Form -->

        <div id="mc_embed_signup">
            <form action="https://matthewkudija.us12.list-manage.com/subscribe/post?u=55dc59a5176654a0fed6d8145&amp;id=74322d0c56" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">

                    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
                    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_55dc59a5176654a0fed6d8145_74322d0c56" tabindex="-1" value=""></div>
                    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
        </div>
        
        <!--End mc_embed_signup-->
    </div>



<section>
  <!-- <h1>Comments</h1> -->
  <div id="disqus_thread"></div>
  <script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://matthewkudija.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>                        


<!--   <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    <script type="text/javascript">
      var disqus_shortname = 'matthewkudija';
      var disqus_identifier = '/2018/03/25/xlwings-mortgage/';
      var disqus_url = '../../../../2018/03/25/xlwings-mortgage/';
      var disqus_title = 'xlwings: Use Python and Excel to Calculate Your Mortgage';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </section> -->


    <p>&copy; 2005<script>new Date().getFullYear()>2005&&document.write("-"+new Date().getFullYear());</script> <a href=https://matthewkudija.com target="_blank">Matthew Kudija</a> | <a href="https://github.com/mkudija/blog" target="_blank">Source</a></p>

</div>

<style type="text/css">
{
    max-width: 700px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
    margin: .2em 0.4em;
    max-width: 580px;
    background-color: #272822;
}

table.dataframe {
    font-family: Courier, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

</div>

<!-- <section id="footer">
    <div class="container">
        <p>
            &copy; 2005<script>new Date().getFullYear()>2005&&document.write("-"+new Date().getFullYear());</script> <a href=https://matthewkudija.com target="_blank">Matthew Kudija</a>
        </p>
        <p>
            <a href="https://github.com/mkudija/blog" target="_blank">Source</a> | Built with <a href= "http://docs.getpelican.com/">Pelican</a> and <a href= "https://pages.github.com/">GitHub Pages</a>.
        </p>   
    </div>
</section>
 -->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72240498-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-72240498-1');
    ga('send', 'pageview');
</script>
<!-- <script type="text/javascript" src="/docs/theme/js/bigfoot.js"></script> -->
<script type="text/javascript" src="../../../../theme/js/bigfoot.js"></script>
<script type="text/javascript">
    $.bigfoot (
    {

    }
    );
</script>
</body>
</html>